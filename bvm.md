# 【課題】自動販売機

### はまりどころ

#### mysql-connecorのバージョン

```bash
pip install  mysql-connector-python
```

mysql-connectorはだめみたい...

[python \- How to install mysql\-connector via pip \- Stack Overflow](https://stackoverflow.com/questions/32754461/how-to-install-mysql-connector-via-pip)



#### Prepared Statement

データが一つの場合もカンマが必要。

```python
        query = ("INSERT INTO stocks (id, count, created_at, updated_at) VALUES (LAST_INSERT_ID(), %s, now(), now())")
        # カンマが必要
        val = (count,)
        cur.execute(query, val)
```





### 購入画面

#### URL

/bvm/

#### 要件

1. ステータスが「公開」のドリンク情報（「商品画像」「商品名」「値段」）を一覧で表示する。

2. 金額を投入するテキストボックスを作成する。

3. ドリンクを選択するラジオボタンを作成する。

4. ドリンクの在庫が0の場合、ドリンクを選択するラジオボタンは表示せず、「売り切れ」と表示する。

5. 購入ボタンを押すと購入結果ページへ遷移する。

   

### 購入完了画面

#### URL

/bvm/result

#### 要件

1. ドリンクの購入が正常に完了した場合、指定ドリンクの「画像」「商品名」「お釣りの情報」を表示する。
2. ドリンクの購入が正常に完了した場合、指定ドリンクの在庫を減らす（管理ページの在庫数が減っていること）。
3. 購入ページへ戻るリンクを作成する。
4. 購入するドリンクを指定していない場合、エラーメッセージを表示して、ドリンクを購入することはできない。
5. 投入金額と指定ドリンクを購入するときに必要な金額を比べ、もし投入金額が足りない場合はエラーメッセージを表示して、ドリンクを購入することはできない。
6. 投入金額は0以上の整数のみ可能である。0以上の整数以外の場合は、エラーメッセージを表示して、ドリンクを購入することはできない。
7. 指定ドリンクの在庫を確認し、もし在庫がなかった場合はエラーメッセージを表示して、ドリンクを購入することはできない（確認手順の例は以下になります）。
   1. 購入ページで、在庫がある商品を表示する。
   2. もう１つのブラウザで管理ページを表示させて、購入予定の在庫がある商品の在庫数を0に変更する（在庫なしにする）。
   3. 別のブラウザで開いていた購入ページで、在庫数を0に変更した商品を選択して、購入するボタンを押した場合、エラーメッセージが表示されること
8. 指定ドリンクのステータスを確認し、もしステータスが非公開の場合はエラーメッセージを表示して、ドリンクを購入することはできない（確認手順の例は以下になります）。
   1. 購入ページで、ステータスが公開の商品を表示する。
   2. もう１つのブラウザで管理ページを表示させて、購入予定のステータスが公開である商品について、ステータスを非公開に変更する（ステータスを非公開にする）。
   3. 別のブラウザで開いていた購入ページで、ステータスを非公開に変更した商品を選択して、購入するボタンを押した場合、エラーメッセージが表示されること。
9. ドリンクの購入が正常に完了した場合、指定ドリンクと購入日時の情報をデータベースに保存する（※この要件は必須ではなく任意です）。



### 商品一覧画面

#### URL

/bvm/drinks/

#### 要件

1. 追加した商品の一覧情報として、「商品画像」、「商品名」、「値段」、「在庫数」、「公開ステータス」のデータを一覧で表示する。



### 商品登録画面

#### URL

/vending/drinks/new

#### 要件

1. 「ドリンク名」「値段」「在庫数」「公開ステータス」を入力し、商品を追加できる。
2. 商品を追加する場合、「商品画像」を指定してアップロードできる。
3. 商品を追加する場合、「商品名」「値段」、「在庫数」、「公開ステータス」「商品画像」のいずれかを指定していない場合、エラーメッセージを表示して、商品を追加できない。
4. 商品を追加する場合、「値段」、「在庫数」は、0以上の整数のみ可能とする。0以上の整数以外はエラーメッセージを表示して、商品を追加できない。
5. 商品を追加する場合、公開ステータスは「公開」あるいは「非公開」のみ可能とする。「公開」あるいは「非公開」以外はエラーメッセージを表示して、商品を追加できない。
6. アップロードできる「商品画像」のファイル形式は「JPEG」、「PNG」のみ可能とする。「JPEG」、「PNG」以外はエラーメッセージを表示して、商品を追加できない。

### 

### 商品変更画面

#### URL

/vending/drinks/update/id

#### 要件

1. 商品一覧から指定ドリンクの在庫数を入力し、在庫数の変更ができる。
2. 商品一覧から指定ドリンクの公開ステータス「公開」あるいは「非公開」の変更ができる。
3. 商品の追加あるいは指定ドリンク情報（「在庫数」、「公開ステータス」）の変更が正常に完了した場合、完了のメッセージを表示する。
4. 商品一覧から指定ドリンクの在庫数を変更する場合、0以上の整数のみ可能とする。0以上の整数以外はエラーメッセージを表示して、変更できない。
